{"ast":null,"code":"import _slicedToArray from \"/Users/God/Desktop/github/Port/portfolio/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/God/Desktop/github/Port/portfolio/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/Users/God/Desktop/github/Port/portfolio/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/Users/God/Desktop/github/Port/portfolio/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/God/Desktop/github/Port/portfolio/client/src/context/Story.js\";\nimport React from 'react';\nimport io from 'socket.io-client';\nexport var CTX = React.createContext();\nvar initState = {\n  chats: {}\n};\nvar channels = [];\n\nfunction reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var _action$payload$msg = action.payload.msg,\n      from = _action$payload$msg.from,\n      msg = _action$payload$msg.msg,\n      to = _action$payload$msg.to;\n  console.log(from, msg, to);\n\n  switch (action.type) {\n    case 'RECIEVE_MESSAGE':\n      if (state.chats[to]) {\n        return _objectSpread({}, state, {\n          chats: _objectSpread({}, state.chats, _defineProperty({}, channels[0], [].concat(_toConsumableArray(state.chats[channels[0]]), [{\n            from: from,\n            msg: msg\n          }])))\n        });\n      } else {\n        return _objectSpread({}, state, {\n          chats: _objectSpread({}, state.chats, _defineProperty({}, channels[0], [{\n            from: from,\n            msg: msg\n          }]))\n        });\n      }\n\n    case 'NEW_ROOM':\n      var nextState = _objectSpread({}, state);\n\n      nextState[to] = [];\n      return {\n        nextState: nextState\n      };\n\n    default:\n      return state;\n  }\n}\n\nvar socket;\n\nfunction Store(props) {\n  var _React$useReducer = React.useReducer(reducer, initState),\n      _React$useReducer2 = _slicedToArray(_React$useReducer, 2),\n      chats = _React$useReducer2[0],\n      dispatch = _React$useReducer2[1];\n\n  function sendChatAction(value) {\n    socket.emit('chat message', value);\n  }\n\n  if (props.username) {\n    socket.emit('new user', props.username);\n  }\n\n  if (!socket) {\n    socket = io(':3001');\n    socket.on('chat message', function (res) {\n      if (res.msg.to !== user) {\n        channels.push(res.msg.to);\n      } else if (res.msg.from !== user) {\n        channels.push(res.msg.from);\n      }\n\n      console.log(channels);\n      console.log(res.msg);\n      dispatch({\n        type: 'RECIEVE_MESSAGE',\n        payload: res\n      });\n    });\n  }\n\n  var user = props.username ? props.username.username : 'Anon';\n  return React.createElement(CTX.Provider, {\n    value: {\n      chats: chats,\n      sendChatAction: sendChatAction,\n      user: user,\n      channels: channels\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }, props.children);\n}\n\nexport default Store;","map":{"version":3,"sources":["/Users/God/Desktop/github/Port/portfolio/client/src/context/Story.js"],"names":["React","io","CTX","createContext","initState","chats","channels","reducer","state","action","payload","msg","from","to","console","log","type","nextState","socket","Store","props","useReducer","dispatch","sendChatAction","value","emit","username","on","res","user","push","children"],"mappings":"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","sourcesContent":["import React from 'react';\nimport io from 'socket.io-client';\n\nexport  const CTX = React.createContext();\n\nconst initState = {\n    chats: {},\n}\n\nconst channels = [];\n\nfunction reducer(state=initState, action) {\n    const { from, msg, to } = action.payload.msg;\n\n    console.log(from, msg, to);\n    switch(action.type) {\n        case 'RECIEVE_MESSAGE':\n            if(state.chats[to]) {\n                return {\n                    ...state,\n                    chats: {\n                        ...state.chats,\n                        [channels[0]]: [...state.chats[channels[0]], {from, msg}]\n                    }\n                }\n            } else {\n                return {\n                    ...state,\n                    chats: {\n                        ...state.chats,\n                        [channels[0]]: [{from, msg}]\n                    }\n                }\n            }\n\n        case 'NEW_ROOM':\n            const nextState = {...state};\n            nextState[to] = [];\n            return {\n                nextState\n            }\n        default:\n            return state\n    }\n}\nlet socket;\n\n\nfunction Store(props) {\n    \n\n    const [chats, dispatch] = React.useReducer(reducer, initState);\n        function sendChatAction(value) {\n            socket.emit('chat message', value);\n        }\n    \n    if(props.username) {\n        socket.emit('new user', props.username)\n    }\n\n    if (!socket) {\n        socket = io(':3001');\n\n        socket.on('chat message', function(res) {\n            if(res.msg.to !== user) {channels.push(res.msg.to);}\n            else if(res.msg.from !== user){channels.push(res.msg.from)}\n            console.log(channels)\n            console.log(res.msg)\n\n            dispatch({type: 'RECIEVE_MESSAGE', payload: res});\n        })\n    }\n    \n    const user = props.username ? props.username.username : 'Anon';\n\n    return (\n        <CTX.Provider value={{chats, sendChatAction, user, channels}}>\n            {props.children}\n        </CTX.Provider>\n    )\n}\n\nexport default Store"]},"metadata":{},"sourceType":"module"}