{"ast":null,"code":"import _slicedToArray from \"/Users/God/Desktop/github/Port/react-portfolio/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/God/Desktop/github/Port/react-portfolio/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/God/Desktop/github/Port/react-portfolio/client/src/components/Showcase/Social/Timeline.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useContext, Fragment, useState, useEffect } from 'react';\nimport AuthContext from '../../../context/AuthContext';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Paper, TextField, Collapse, List, ListItem, ListItemText, ListItemAvatar, Divider, Avatar, Icon, IconButton, CircularProgress } from '@material-ui/core';\nimport Moment from 'react-moment';\nimport GetMoment from 'moment';\nvar useStyles = makeStyles(function (theme) {\n  var _root;\n\n  return {\n    root: (_root = {}, _defineProperty(_root, theme.breakpoints.down('xs'), {\n      width: '90%'\n    }), _defineProperty(_root, \"paddingTop\", '10px'), _defineProperty(_root, \"paddingBottom\", '10px'), _defineProperty(_root, \"width\", '80%'), _defineProperty(_root, \"margin\", '0 auto'), _root),\n    listItem: {\n      marginTop: '20px'\n    },\n    form: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    Collapse: {\n      marginBottom: '20px'\n    }\n  };\n});\n\nvar Timeline = function Timeline() {\n  var auth = useContext(AuthContext);\n  var classes = useStyles();\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      commentInput = _useState2[0],\n      setCommentInput = _useState2[1];\n\n  var _useState3 = useState({\n    open: false,\n    storyId: ''\n  }),\n      _useState4 = _slicedToArray(_useState3, 2),\n      newComment = _useState4[0],\n      setNewComment = _useState4[1];\n\n  var _useState5 = useState({}),\n      _useState6 = _slicedToArray(_useState5, 2),\n      storyIDs = _useState6[0],\n      setStoryIDs = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      stories = _useState8[0],\n      setStories = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      onLoad = _useState10[0],\n      setOnLoad = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      sorted = _useState12[0],\n      setSorted = _useState12[1];\n\n  useEffect(function () {\n    if (auth.isLoaded && auth.newStory) {\n      auth.updateLoaded(auth.user, false, false);\n      getStories();\n      setSorted(false);\n    }\n\n    if (!onLoad && auth.user) {\n      setOnLoad(true);\n      var storyStorage = [];\n      var storyIDList = {};\n      auth.user.info.authored_stories.map(function (story) {\n        storyIDList[story._id] = false;\n        storyStorage.push(story);\n      });\n      storyStorage.sort(function (a, b) {\n        return new Date(b.time) - new Date(a.time);\n      });\n      setStoryIDs(storyIDList);\n      setSorted(true);\n      setStories(storyStorage);\n    }\n\n    if (newComment.open) {\n      setNewComment({\n        open: false,\n        storyId: ''\n      });\n      var _storyStorage = [];\n      var _storyIDList = {};\n      stories.map(function (story) {\n        if (story._id === newComment.storyId) {\n          _storyStorage.push(story);\n\n          _storyIDList[story._id] = true;\n        } else {\n          _storyIDList[story._id] = false;\n\n          _storyStorage.push(story);\n        }\n      });\n\n      _storyStorage.sort(function (a, b) {\n        return new Date(b.time) - new Date(a.time);\n      });\n\n      setStoryIDs(_storyIDList);\n      setSorted(true);\n      setStories(_storyStorage);\n    }\n  });\n\n  var getStories = function getStories() {\n    fetch('/api/social/friendStories', {\n      method: 'POST',\n      body: JSON.stringify({\n        id: auth.user.info\n      }),\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (result) {\n      var storyStorage = result;\n      var storyIDList = {};\n      auth.user.info.authored_stories.map(function (story, index) {\n        storyIDList[story._id] = false;\n        storyStorage.push(story);\n      });\n      storyStorage.sort(function (a, b) {\n        return new Date(b.time) - new Date(a.time);\n      });\n      setStories(storyStorage);\n      setSorted(true);\n      setStoryIDs(storyIDList);\n    });\n  };\n\n  var handleDelete = function handleDelete(id) {\n    fetch('/api/social/deleteStory', {\n      method: 'POST',\n      body: JSON.stringify({\n        id: id\n      }),\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(function () {});\n  };\n\n  var handleCommentInput = function handleCommentInput(e) {\n    var value = e.target.value;\n    setCommentInput(value);\n  };\n\n  var handleCommentSubmit = function handleCommentSubmit(id, username) {\n    var time = GetMoment();\n    var data = {\n      time: time,\n      id: id,\n      userId: auth.user._id,\n      comment: commentInput\n    };\n    var newStories = stories;\n    newStories.map(function (item, index) {\n      if (item._id === id) {\n        newStories[index].comments.push({\n          authored_by: {\n            info: '5d126d136f6f1085c8df8b81',\n            username: username\n          },\n          text: commentInput,\n          type: 'comment',\n          time: time\n        });\n      }\n    });\n    setStories(newStories);\n    setNewComment({\n      open: true,\n      storyId: id\n    });\n    fetch('/api/social/newComment', {\n      method: 'POST',\n      body: JSON.stringify({\n        data: data\n      }),\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function () {\n      setCommentInput('');\n    });\n  };\n\n  var renderTimeline = function renderTimeline() {\n    if (sorted && !auth.newStory) {\n      return stories.map(function (story, index) {\n        return React.createElement(Paper, {\n          key: story._id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        }, React.createElement(ListItem, {\n          className: classes.listItem,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, React.createElement(ListItemAvatar, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 200\n          },\n          __self: this\n        }, React.createElement(Avatar, {\n          alt: story._id,\n          src: \"./imgs/me.png\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201\n          },\n          __self: this\n        })), React.createElement(ListItemText, {\n          primary: \"\".concat(story.authored_by.username, \": \").concat(story.text),\n          secondary: React.createElement(Moment, {\n            date: story.time,\n            format: 'dddd h:mm a',\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 206\n            },\n            __self: this\n          }),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 204\n          },\n          __self: this\n        }), React.createElement(IconButton, {\n          onClick: function onClick() {\n            return expandComment(story._id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 209\n          },\n          __self: this\n        }, React.createElement(Icon, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }, storyIDs ? storyIDs[story._id] ? 'expand_less' : 'expand_more' : false)), React.createElement(IconButton, {\n          onClick: function onClick() {\n            return handleDelete(story._id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 213\n          },\n          __self: this\n        }, React.createElement(Icon, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 214\n          },\n          __self: this\n        }, \"delete_outline\"))), React.createElement(Collapse, {\n          className: classes.collapse,\n          in: storyIDs ? storyIDs[story._id] : false,\n          timeout: \"auto\",\n          unmountOnExit: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 219\n          },\n          __self: this\n        }, React.createElement(List, {\n          disablePadding: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 221\n          },\n          __self: this\n        }, renderComments(story.comments)), React.createElement(\"div\", {\n          className: classes.form,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 225\n          },\n          __self: this\n        }, React.createElement(TextField, {\n          name: \"123\",\n          value: commentInput,\n          variant: \"outlined\",\n          label: \"Add a comment\",\n          onChange: handleCommentInput,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 227\n          },\n          __self: this\n        }), React.createElement(IconButton, {\n          onClick: function onClick() {\n            return handleCommentSubmit(story._id, story.authored_by.username);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 235\n          },\n          __self: this\n        }, React.createElement(Icon, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 236\n          },\n          __self: this\n        }, \"add_circle\")))));\n      });\n    } else {\n      return React.createElement(CircularProgress, {\n        size: 100,\n        color: \"secondary\",\n        thickness: 2.6,\n        style: {\n          display: 'block',\n          margin: '40px auto 0px auto'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      });\n    }\n  };\n\n  var renderComments = function renderComments(comments) {\n    var commentList = [];\n\n    if (comments.length < 5) {\n      commentList = comments.slice(0, comments.length);\n    } else {\n      commentList = comments.slice(0, 5);\n    }\n\n    return commentList.map(function (comment, index) {\n      return React.createElement(Fragment, {\n        key: comment.time,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263\n        },\n        __self: this\n      }, React.createElement(Divider, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265\n        },\n        __self: this\n      }), React.createElement(ListItem, {\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      }, React.createElement(ListItemText, {\n        primary: \"\".concat(comment.authored_by.username, \": \").concat(comment.text),\n        secondary: React.createElement(Moment, {\n          date: comment.time,\n          format: 'dddd h:mm a',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 268\n          },\n          __self: this\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268\n        },\n        __self: this\n      })));\n    });\n  };\n\n  var expandComment = function expandComment(id) {\n    var newCommentState = !storyIDs[id];\n    setStoryIDs(_objectSpread({}, storyIDs, _defineProperty({}, id, newCommentState)));\n  };\n\n  return React.createElement(List, {\n    className: classes.root,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285\n    },\n    __self: this\n  }, renderTimeline());\n};\n\nexport default Timeline;","map":{"version":3,"sources":["/Users/God/Desktop/github/Port/react-portfolio/client/src/components/Showcase/Social/Timeline.js"],"names":["React","useContext","Fragment","useState","useEffect","AuthContext","makeStyles","Paper","TextField","Collapse","List","ListItem","ListItemText","ListItemAvatar","Divider","Avatar","Icon","IconButton","CircularProgress","Moment","GetMoment","useStyles","theme","root","breakpoints","down","width","listItem","marginTop","form","display","alignItems","marginBottom","Timeline","auth","classes","commentInput","setCommentInput","open","storyId","newComment","setNewComment","storyIDs","setStoryIDs","stories","setStories","onLoad","setOnLoad","sorted","setSorted","isLoaded","newStory","updateLoaded","user","getStories","storyStorage","storyIDList","info","authored_stories","map","story","_id","push","sort","a","b","Date","time","fetch","method","body","JSON","stringify","id","headers","then","res","json","result","index","handleDelete","handleCommentInput","e","value","target","handleCommentSubmit","username","data","userId","comment","newStories","item","comments","authored_by","text","type","renderTimeline","expandComment","collapse","renderComments","margin","commentList","length","slice","newCommentState"],"mappings":"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","sourcesContent":["import React, { useContext, Fragment, useState, useEffect } from 'react';\n\nimport AuthContext from '../../../context/AuthContext';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Paper, TextField, Collapse, List, ListItem, ListItemText, ListItemAvatar, Divider, Avatar, Icon, IconButton, CircularProgress} from '@material-ui/core';\n\nimport Moment from 'react-moment';\nimport GetMoment from 'moment';\n\nconst useStyles = makeStyles(theme => ({\n    root: {\n        [theme.breakpoints.down('xs')]: {\n            width: '90%',\n        },\n        paddingTop: '10px',\n        paddingBottom: '10px',\n        width: '80%',\n        margin: '0 auto'\n    },\n    listItem: {\n        marginTop: '20px',\n    },\n    form: {\n        display: 'flex',\n        alignItems: 'center',\n    },\n    Collapse: {\n        marginBottom: '20px',\n    },\n}));\n\nconst Timeline = () => {\n\n    const auth = useContext(AuthContext);\n    const classes = useStyles();\n\n    const [commentInput, setCommentInput] = useState('');\n    const [newComment, setNewComment] = useState({open: false, storyId: ''});\n\n    const [storyIDs, setStoryIDs] = useState({});\n    const [stories, setStories] = useState('');\n    const [onLoad, setOnLoad] = useState(false);\n    const [sorted, setSorted] = useState(false);\n\n\n    useEffect(() => {\n        \n        if( (auth.isLoaded) && (auth.newStory) ) {\n\n            auth.updateLoaded(auth.user, false, false);\n            getStories();\n            setSorted(false)\n        }\n\n        if( (!onLoad) && (auth.user) ) {\n\n            setOnLoad(true)\n\n            let storyStorage = [];\n            let storyIDList = {};\n            \n            auth.user.info.authored_stories.map((story) => {\n                storyIDList[story._id] = false\n                storyStorage.push(story);\n            });\n\n            storyStorage.sort((a, b) => {\n                return new Date(b.time) - new Date(a.time);\n            });\n\n            setStoryIDs(storyIDList);\n            setSorted(true);\n            setStories(storyStorage);\n        }   \n\n        if(newComment.open) {\n\n            setNewComment({open: false, storyId: ''});\n            \n            let storyStorage = [];\n            let storyIDList = {};\n            \n            stories.map((story) => {\n                \n                if(story._id === newComment.storyId){\n                    storyStorage.push(story); \n                    storyIDList[story._id] = true\n                } \n                else {\n                    storyIDList[story._id] = false\n                    storyStorage.push(story); \n                }\n                \n            });\n\n            storyStorage.sort((a, b) => {\n                return new Date(b.time) - new Date(a.time);\n            });\n\n            setStoryIDs(storyIDList);\n            setSorted(true)\n            setStories(storyStorage);\n        }\n    });\n\n    const getStories = () => {\n\n        fetch('/api/social/friendStories', {\n            method: 'POST',\n            body: JSON.stringify({id: auth.user.info}),\n            headers: {'Content-Type': 'application/json'}\n        })\n        .then(res => res.json())\n        .then((result) => {\n            \n            let storyStorage = result;\n            let storyIDList = {};\n            \n            auth.user.info.authored_stories.map((story, index) => {\n                storyIDList[story._id] = false\n                storyStorage.push(story);\n            });\n            \n            storyStorage.sort((a, b) => {\n                return new Date(b.time) - new Date(a.time);\n            })\n\n            setStories(storyStorage);\n            setSorted(true);\n            setStoryIDs(storyIDList);\n        });\n    };\n    \n    const handleDelete = (id) => {\n\n        fetch('/api/social/deleteStory', {\n            method: 'POST',\n            body: JSON.stringify({id: id}),\n            headers: {'Content-Type': 'application/json'}\n        })\n        .then(() => {});\n    };\n\n    const handleCommentInput = (e) => {\n        const { value } = e.target;\n        setCommentInput(value);\n    };\n\n    const handleCommentSubmit = (id, username) => {\n\n        const time = GetMoment(); \n        const data = {\n            time: time,\n            id: id,\n            userId: auth.user._id,\n            comment: commentInput,\n        };\n\n        let newStories = stories;\n\n        newStories.map((item, index) => {\n            \n            if(item._id === id) {\n                newStories[index].comments.push({\n                    authored_by: {info: '5d126d136f6f1085c8df8b81', username: username},\n                    text: commentInput,\n                    type: 'comment',\n                    time: time\n                });\n            }\n        });\n\n        setStories(newStories);\n        setNewComment({open: true, storyId: id});\n\n        fetch('/api/social/newComment', {\n            method: 'POST',\n            body: JSON.stringify({data}),\n            headers: {'Content-Type': 'application/json'}\n        })\n        .then(res => res.json())\n        .then(() => {\n            setCommentInput('');\n        });\n    };\n\n    const renderTimeline = () => {\n\n        if( (sorted) && (!auth.newStory) ){\n\n            return (\n\n                stories.map((story, index) => (\n\n                    <Paper key={story._id}>\n\n                        <ListItem className={classes.listItem}>\n\n                            <ListItemAvatar>\n                                <Avatar alt={story._id} src={`./imgs/me.png`} />\n                            </ListItemAvatar>\n\n                            <ListItemText \n                                primary={`${story.authored_by.username}: ${story.text}`} \n                                secondary={<Moment date={story.time} format={'dddd h:mm a'} />}\n                            />\n                            \n                            <IconButton onClick={() => expandComment(story._id)}>\n                                <Icon>{storyIDs ? storyIDs[story._id] ? 'expand_less' : 'expand_more' : false}</Icon>\n                            </IconButton>\n\n                            <IconButton onClick={() => handleDelete(story._id)}>\n                                <Icon>delete_outline</Icon>\n                            </IconButton>\n\n                        </ListItem>\n\n                        <Collapse className={classes.collapse} in={storyIDs ? storyIDs[story._id] : false} timeout=\"auto\" unmountOnExit>\n                            \n                            <List disablePadding>\n                                {renderComments(story.comments)}\n                            </List>\n\n                            <div className={classes.form}>\n\n                                <TextField\n                                    name='123'\n                                    value={commentInput}\n                                    variant=\"outlined\"\n                                    label=\"Add a comment\"\n                                    onChange={handleCommentInput}\n                                />\n\n                                <IconButton onClick={() => handleCommentSubmit(story._id, story.authored_by.username)}>\n                                    <Icon>add_circle</Icon>\n                                </IconButton>\n\n                            </div>\n\n                        </Collapse>\n\n                    </Paper>\n                ))\n            );          \n        } \n        else { return <CircularProgress size={100} color=\"secondary\" thickness={2.6} style={{display: 'block', margin: '40px auto 0px auto'}}  /> }\n    };\n\n    const renderComments = (comments) => {\n\n        let commentList = [];\n\n        if(comments.length < 5) { commentList = comments.slice(0, comments.length) }\n        else { commentList = comments.slice(0, 5) }\n        \n        return (\n\n            commentList.map((comment, index) => {\n\n                return (  \n\n                    <Fragment key={comment.time}>\n\n                        <Divider />\n\n                        <ListItem key={index}>\n                            <ListItemText primary={`${comment.authored_by.username}: ${comment.text}`} secondary={<Moment date={comment.time} format={'dddd h:mm a'} />} />\n                        </ListItem>\n\n                    </Fragment>\n                );\n            })\n        );\n    };\n\n    const expandComment = (id) => {\n\n        const newCommentState = !storyIDs[id];\n        setStoryIDs({...storyIDs, [id]: newCommentState});\n    };\n\n    return (\n\n        <List className={classes.root}>\n            {renderTimeline()}\n        </List>\n    );\n};\n\nexport default Timeline;"]},"metadata":{},"sourceType":"module"}