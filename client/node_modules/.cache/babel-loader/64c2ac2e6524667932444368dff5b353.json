{"ast":null,"code":"import _toConsumableArray from \"/Users/God/Desktop/github/Port/portfolio/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/God/Desktop/github/Port/portfolio/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/God/Desktop/github/Port/portfolio/client/src/pages/Chat/Chat.js\";\nimport React, { Fragment, useEffect, useState, useContext, useRef } from 'react';\nimport { COMMUNITY_CHAT, MESSAGE_SENT, MESSAGE_RECIEVED, TYPING } from '../../socket/events';\nimport AuthContext from '../../context/AuthContext';\nimport SideBar from './SideBar';\nimport ChatHeading from './chatHeading';\nimport Messages from './messages/Messages';\nimport MessageInput from './messages/MessageInput';\n\nfunction Chat(props) {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      chats = _useState2[0],\n      setChats = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      activeChat = _useState4[0],\n      setActiveChat = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loaded = _useState6[0],\n      setLoaded = _useState6[1];\n\n  var auth = useContext(AuthContext);\n  useEffect(function () {\n    if (!loaded && auth.socket) {\n      setLoaded(true);\n      var socket = props.socket;\n      auth.socket.emit(COMMUNITY_CHAT, resetChat);\n    }\n  });\n\n  function resetChat(chat) {\n    return addChat(chat, true);\n  }\n\n  function addChat(chat, reset) {\n    var socket = props.socket;\n    var newChats = reset ? [chat] : [].concat(_toConsumableArray(chats), [chat]);\n    setChats({\n      chats: newChats\n    });\n    setActiveChat({\n      activeChat: reset ? chat : activeChat\n    });\n    var messageEvent = \"\".concat(MESSAGE_RECIEVED, \"=\").concat(chat.id);\n    var typingEvent = \"\".concat(TYPING, \"=\").concat(chat.id);\n    auth.socket.on(typingEvent, updateTypingChat(chat.id));\n    auth.socket.on(messageEvent, addMessageToChat(chat.id));\n  }\n\n  function addMessageToChat(chatId) {\n    return function (message) {\n      var newChats = chats.map(function (chat) {\n        if (chat.id === chatId) {\n          chat.messages.push(message);\n        }\n\n        return chat;\n      });\n      setChats({\n        chats: newChats\n      });\n    };\n  }\n\n  function updateTypingChat(chatId) {\n    return function (_ref) {\n      var isTyping = _ref.isTyping,\n          user = _ref.user;\n\n      if (user !== props.user.name) {\n        var newChats = chats.map(function (chat) {\n          if (chat.id === chatId) {\n            if (isTyping && !chat.typingUsers.includes(user)) {\n              chat.typingUsers.push(user);\n            } else if (!isTyping && chat.typingUser.includes(user)) {\n              chat.typingUsers = chat.typingUsers.filter(function (u) {\n                return u !== user;\n              });\n            }\n          }\n\n          return chat;\n        });\n        setChats({\n          chats: newChats\n        });\n      }\n    };\n  }\n\n  function sendTyping(chatId, message) {\n    var socket = props.socket;\n    socket.emit(MESSAGE_SENT, {\n      chatId: chatId,\n      message: message\n    });\n  }\n\n  function updateActiveChat(activeChat) {\n    setActiveChat(activeChat);\n  }\n\n  function renderChat() {\n    var _this = this;\n\n    return React.createElement(AuthContext.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }, function (_ref2) {\n      var auth = _ref2.auth;\n      console.log(auth);\n      return React.createElement(Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90\n        },\n        __self: this\n      }, React.createElement(SideBar, {\n        logout: props.logout,\n        chats: chats,\n        user: auth.sockUser,\n        activeChat: activeChat,\n        setActiveChat: updateActiveChat,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"chat-room-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }, activeChat !== null ? React.createElement(\"div\", {\n        className: \"chat-room\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }, React.createElement(ChatHeading, {\n        name: activeChat.name,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103\n        },\n        __self: this\n      }), React.createElement(Messages, {\n        messages: activeChat.messages,\n        user: auth.sockUser,\n        typingUsers: activeChat.typingUsers,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      }), React.createElement(MessageInput, {\n        sendMessage: function sendMessage(message) {\n          _this.sendMessage(activeChat.id, message);\n        },\n        sendTyping: function sendTyping(isTyping) {\n          _this.sendTyping(activeChat.id, isTyping);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      })) : React.createElement(\"div\", {\n        className: \"chat-room choose\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, \"Choose a chat!\")))));\n    });\n  }\n\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, auth.sockUser ? renderChat() : '');\n}\n\nexport default Chat;","map":{"version":3,"sources":["/Users/God/Desktop/github/Port/portfolio/client/src/pages/Chat/Chat.js"],"names":["React","Fragment","useEffect","useState","useContext","useRef","COMMUNITY_CHAT","MESSAGE_SENT","MESSAGE_RECIEVED","TYPING","AuthContext","SideBar","ChatHeading","Messages","MessageInput","Chat","props","chats","setChats","activeChat","setActiveChat","loaded","setLoaded","auth","socket","emit","resetChat","chat","addChat","reset","newChats","messageEvent","id","typingEvent","on","updateTypingChat","addMessageToChat","chatId","message","map","messages","push","isTyping","user","name","typingUsers","includes","typingUser","filter","u","sendTyping","updateActiveChat","renderChat","console","log","logout","sockUser","sendMessage"],"mappings":"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","sourcesContent":["import React, { Fragment, useEffect, useState, useContext, useRef } from 'react';\n\nimport { COMMUNITY_CHAT, MESSAGE_SENT, MESSAGE_RECIEVED, TYPING } from '../../socket/events';\nimport AuthContext from '../../context/AuthContext';\n\nimport SideBar from './SideBar';\nimport ChatHeading from './chatHeading';\nimport Messages from './messages/Messages';\nimport MessageInput from './messages/MessageInput';\n\nfunction Chat(props) {\n\n    const [chats, setChats] = useState([]);\n    const [activeChat, setActiveChat] = useState('');\n    const [loaded, setLoaded] = useState(false);\n\n    const auth = useContext(AuthContext);\n\n    useEffect(() => {\n        if(!loaded && auth.socket) {\n            setLoaded(true);\n            const { socket } = props;\n            auth.socket.emit(COMMUNITY_CHAT, resetChat);\n        }\n    })\n\n    function resetChat(chat) {\n        return addChat(chat, true);\n    }\n\n    function addChat(chat, reset) {\n        const { socket } = props;\n        const newChats = reset ? [chat] : [...chats, chat];\n        setChats({chats: newChats})\n        setActiveChat({activeChat:reset ? chat : activeChat});\n        const messageEvent = `${MESSAGE_RECIEVED}=${chat.id}`;\n        const typingEvent = `${TYPING}=${chat.id}`;\n        \n        auth.socket.on(typingEvent, updateTypingChat(chat.id));\n        auth.socket.on(messageEvent, addMessageToChat(chat.id));\n    } \n\n    function addMessageToChat(chatId) {\n        return message => {\n            let newChats = chats.map((chat) => {\n                if (chat.id === chatId) {\n                    chat.messages.push(message);\n                }\n                return chat;\n            });\n            setChats({chats: newChats});\n        };\n    }\n\n    function updateTypingChat(chatId) {\n        return ({isTyping, user}) => {\n            if(user !== props.user.name) {\n                let newChats = chats.map((chat) => {\n                    if(chat.id === chatId) {\n                        if(isTyping && !chat.typingUsers.includes(user)) {\n                            chat.typingUsers.push(user);\n                        } else if (!isTyping && chat.typingUser.includes(user)) {\n                            chat.typingUsers = chat.typingUsers.filter(u => u !== user)\n                        }\n                    }\n                    return chat;\n                })\n                setChats({chats: newChats});\n            }\n        }\n    }\n\n    function sendTyping(chatId, message) {\n        const { socket } = props;\n        socket.emit(MESSAGE_SENT, {chatId, message});\n    }\n\n    function updateActiveChat(activeChat) {\n        setActiveChat(activeChat);\n    }\n\n    function renderChat() {\n        return (\n            <AuthContext.Consumer>\n                \n                {({auth}) => {\n                    console.log(auth)\n                    return (\n                        <Fragment>\n                                <div className=\"container\">\n                                    <SideBar\n                                        logout={props.logout}\n                                        chats={chats}\n                                        user={auth.sockUser}\n                                        activeChat={activeChat}\n                                        setActiveChat={updateActiveChat}\n                                        />\n                                    <div className=\"chat-room-container\">\n                                        {\n                                            activeChat !== null ? (\n                \n                                                <div className=\"chat-room\">\n                                                    <ChatHeading name={activeChat.name} />\n                                                    <Messages \n                                                        messages={activeChat.messages}\n                                                        user={auth.sockUser}\n                                                        typingUsers={activeChat.typingUsers}\n                                                    />\n                                                    <MessageInput \n                                                        sendMessage={\n                                                            (message)=>{\n                                                                this.sendMessage(activeChat.id, message)\n                                                            }\n                                                        }\n                                                        sendTyping={\n                                                            (isTyping)=>{\n                                                                this.sendTyping(activeChat.id, isTyping)\n                                                            }\n                                                        }\n                                                    />\n                \n                                                </div>\n                                            ):\n                                            <div className=\"chat-room choose\">\n                                                <h3>Choose a chat!</h3>\n                                            </div>\n                                        }\n                                    </div>\n                \n                                </div>\n                        </Fragment>\n                    )\n                }}\n            </AuthContext.Consumer>\n        )\n    }\n\n    return (\n        <Fragment>\n            {auth.sockUser ? renderChat() : ''}\n        </Fragment>\n    )\n}\n\nexport default Chat;"]},"metadata":{},"sourceType":"module"}